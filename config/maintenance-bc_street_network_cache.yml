sql:
- name: truncate table coagis.bc_street_network_cache
  text: truncate table coagis.bc_street_network_cache;
  values:
- name: update bc_street_network_cache
  text: insert into coagis.bc_street_network_cache ( SELECT DISTINCT bc_street.objectid::integer, bc_street.centerline_id::numeric(38,8), (case when (select de.centerline_id from coagis.bc_street_dead_ends_cache as de where de.centerline_id = bc_street.centerline_id) is not null then 10 else case when snowremoval = 'PRIMARY' and bc_street.road_class = 7  then 4 else case when snowremoval = 'SECONDARY' and bc_street.road_class = 7  then 5 else bc_street.road_class end end end)::integer as road_class, bc_street.street_prefix::character varying(2), bc_street.street_name::character varying(30), bc_street.street_type::character varying(4), bc_street.street_postdirection::character varying(2), bc_street.street_dupe::character varying(1), bc_street.full_street_name::character varying(32), COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline),  (case when bc_street.street_type = 'EXT' then 5 else  case when (select de.centerline_id from coagis.bc_street_dead_ends_cache as de where de.centerline_id = bc_street.centerline_id) is not null then 2 else  case when bc_street.road_class =  1 then 55  else   case when bc_street.road_class =  2 then 45  else   case when bc_street.road_class =  3 then 45  else   case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else   case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else   case when bc_street.road_class =  7 then 20   else  25   end end end end end end end end)      )::integer as speed_limit, bc_street.lane_count::integer, bc_street.left_from_address::integer, bc_street.left_to_address::integer, bc_street.right_from_address::integer, bc_street.right_to_address::integer, bc_street.user_id:: character varying(8), bc_street.create_date::timestamp without time zone, bc_street.change_date::timestamp without time zone, bc_street.lesn::integer, bc_street.resn::integer, bc_street.lzip::integer, bc_street.rzip::integer, bc_street.lcommcode::character varying(4), bc_street.rcommcode::character varying(4), bc_street.route_id::character varying(20), bc_street.maximo_type::character varying(30), bc_street.maximo_seq_num::integer, bc_street.asset_code::character varying(50), (CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  10 then 10 else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  15 then 8 else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  20 then 8 else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  25 then 4  else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  30 then 2 else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  35 then 1.1 else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  40 then 1.1 else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  45 then 1.0 else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  50 then 1.0  else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  55 then 1.0 else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  60 then 1.1 else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  65 then 1.25 else CASE  WHEN  COALESCE((SELECT max(spd.speedlimit) from  coagis.coa_street_speed_limits_table as spd where bc_street.centerline_id  = spd.centerline), (case when bc_street.road_class =  1 then 55  else case when bc_street.road_class =  2 then 45  else case when bc_street.road_class =  3 then 45  else case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 35  else case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 25  else case when bc_street.road_class =  7 then 20   else  25 end end end end end end )) =  70 then 1.5 else 1.0 end end end end end end end end end end end end end)::character varying(8) as mrc,   bc_street.min_range::integer, bc_street.max_range::integer, (case when coa_street_one_way_table.azimuth is null then 'false' else 'true' end)::character varying(5) as oneway, (case when coa_street_no_trucks_table.pid is null then 0 else 1 end)::integer as notrucks, (case when road_class = 1 or road_class = 2 or road_class = 3 or road_class = 4 or road_class = 5 or road_class = 9 then 'false' else 'true' end)::character varying(5) as pedestrainfriendly, (case when road_class = 8 then 'true' else 'false' end)::character varying(5) as pedestrainonly, (case when    COALESCE (  coa_street_one_way_table.azimuth::numeric(10,2)  = ((ST_Azimuth(ST_StartPoint(bc_street.shape),ST_EndPoint(bc_street.shape)))/(2*pi())*360)::numeric(10,2) ,'t'::boolean)::boolean then  bc_street.shape else ST_Reverse(bc_street.shape)  end )::geometry  as shape, ((case when (select de.centerline_id from coagis.bc_street_dead_ends_cache as de where de.centerline_id = bc_street.centerline_id) is not null then 3 else  case when bc_street.road_class =  1 then 1  else   case when bc_street.road_class =  2 then 1  else   case when bc_street.road_class =  3 then 1  else   case when ( snowremoval = 'PRIMARY' and bc_street.road_class = 7  ) then 1  else   case when ( snowremoval = 'SECONDARY' and bc_street.road_class = 7  ) then 3  else   case when bc_street.road_class =  7 then 3  else  3  end end end end end end end)      )::integer as sideofstreet    FROM coagis.bc_street LEFT JOIN coagis.coa_street_no_trucks_table  ON  coagis.bc_street.centerline_id =  coagis.coa_street_no_trucks_table.centerline LEFT JOIN coagis.coa_street_one_way_table ON bc_street.centerline_id = coa_street_one_way_table.centerlineid    left join coagiswarehouse.coagis.coa_street_maintenance_snow_view as seg on  bc_street.centerline_id::numeric(38,8) = seg.centerline_id::numeric(38,8)  );
  values:
- name: VACUUM coagis.bc_street_network_cache;
  text: VACUUM FULL ANALYZE coagis.bc_street_network_cache;
  values:
